<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
      crossorigin="anonymous"
    />
    <title>Seminar 9-10</title>

    <style>
      body {
        background-color: azure;
        padding-top: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 18px;
      }

      form {
        background-color: pink;
        min-width: 750px;
        height: auto;
      }

      .form-select {
        margin-top: 5px;
        padding: 7px;
        font-size: 16px;
        cursor: pointer;
      }

      .form-select:focus,
      .form-control:focus {
        border-color: #ff0080;
        box-shadow: 0 0 0 0.25rem rgba(255, 0, 128, 0.25);
      }

      table {
        width: 100%;
        border-collapse: separate;
        border: 1px solid black;
        padding: 3px;
      }

      td,
      th {
        border: 1px solid black;
        padding: 8px;
      }

      .form-control {
        width: 10%;
        display: inline-block;
        font-size: 16px;
        padding: 3px 8px;
        margin-right: 15px;
        margin-left: 10px;
      }

      #Cost,
      #TotalCost {
        width: 15%;
      }

      .form-check-input {
        cursor: pointer;
      }

      .form-check-input:checked {
        background-color: #ff0080;
        border-color: #ff0080;
      }

      .form-check-input:focus {
        box-shadow: 0 0 0 0.25rem rgba(255, 0, 128, 0.25);
        border-color: #ff0080;
      }

      #DeliveryAdress {
        width: 60%;
        font-size: 16px;
        padding: 5px 8px;
        margin: 5px 0px;
        display: none;
      }

      button {
        background-color: white;
        padding: 5px 10px;
        font-size: 16px;
        border-radius: 5px;
        border: 1px solid #b5bdc5;
        transition: background-color 0.15s, border-color 0.15s;
      }

      button:hover {
        background-color: rgb(255, 223, 253);
        border-color: #ff0080;
      }

      button:active {
        background-color: rgba(255, 176, 252, 0.77);
      }

      .row8 .form-control {
        width: auto;
      }

      #CostWithoutShipping {
        width: 30%;
      }

      #CostWithoutShipping:not(:placeholder-shown) {
        width: 15%;
      }

      input.error {
        border: 1px solid #f5a6a6;
        background-color: #fff0f0;
        color: #c0392b;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <form onsubmit="return validateForm()">
      <table>
        <tr>
          <td class="text-center fs-4">Замовлення на придбання товару</td>
        </tr>
        <tr>
          <td>
            <label for="Book">Назва товару</label>
            <br />
            <select class="form-select w-75" name="Book" id="Book">
              <option value="Джейн Ейр">
                Джейн Ейр (Шарлотта Бронте) - 280грн
              </option>
              <option value="No Longer Human">
                No Longer Human (Осаму Дадзай) - 713грн
              </option>
              <option value="Інститут">Інститут (Стівен Кінг) - 490грн</option>
              <option value="Оніксова буря">
                Оніксова буря (Ребекка Яррос) - 850грн
              </option>
              <option value="Вбивство на вулиці Морг">
                Вбивство на вулиці Морг (Едгар Аллан По) - 216грн
              </option>
              <option value="Великий Гетсбі">
                Великий Гетсбі (Френсіс Скотт Фіцджеральд) - 330грн
              </option>
              <option value="1984">1984 (Джордж Орвелл) - 144грн</option>
              <option value="Перетворення">
                Перетворення (Франц Кафка) - 332грн
              </option>
              <option value="Благословення небесного урядника">
                Благословення небесного урядника (Мосян Тонсьов) - 320грн
              </option>
              <option value="Засновник демонічного шляху">
                Засновник демонічного шляху (Мосян Тонсьов) - 360грн
              </option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <label for="Quantity">Кількість: </label>
            <input type="number" id="Quantity" class="form-control" min="1" />
            <label for="Cost">Вартість:</label>
            <input
              type="text"
              id="Cost"
              class="form-control"
              readonly="readonly"
            />
            <button type="button" onclick="addBook()">Додати книгу</button>
          </td>
        </tr>
        <tr>
          <td>
            <h5>Обране замовлення:</h5>
            <ul id="OrderList"></ul>
            <input
              type="text"
              id="CostWithoutShipping"
              class="form-control"
              readonly
              placeholder="Загальна вартість (без доставки)"
            />
          </td>
        </tr>
        <tr>
          <td>
            <label>Спосіб доставки замовлення</label>
            <br />
            <label>
              <input
                class="form-check-input"
                type="radio"
                name="delivery"
                id="Post"
                checked
              />
              Пошта (+5%)
            </label>
            <br />
            <label>
              <input
                class="form-check-input"
                type="radio"
                name="delivery"
                id="Delivery"
              />
              Доставка до дому (+15%)
            </label>
            <br />
            <input
              type="adress"
              class="form-control"
              placeholder="Введіть адресу"
              id="DeliveryAdress"
            />
            <label for="">
              <input class="form-check-input" id="GiftWrap" type="checkbox" />
              У святковій упаковці (+10%)
            </label>
          </td>
        </tr>
        <tr>
          <td>
            <label for="Promocode">Промокод: </label>
            <input
              type="text"
              class="form-control w-25"
              id="Promocode"
              placeholder="Промокод"
            />
            <button type="button" onclick="UsePromocode()">
              Застосувати промокод
            </button>
          </td>
        </tr>
        <tr>
          <td class="text-end">
            <label for="TotalCost"> Загальна вартість замовлення </label>
            <input
              type="text"
              class="form-control"
              id="TotalCost"
              readonly="readonly"
            />
            <button type="button" onclick="CalculateCost()">Підрахувати</button>
          </td>
        </tr>
        <tr>
          <td class="row8">
            <label>Дані користувача</label>
            <br />
            <label>
              Ім'я:
              <input
                type="text"
                class="form-control"
                id="CustomerName"
                placeholder="Введіть ім'я"
                required
              />
            </label>
            <label>
              Прізвище:
              <input
                type="text"
                class="form-control"
                id="CustomerSurname"
                placeholder="Введіть прізвище"
                required
              />
            </label>
            <label>
              Телефон:
              <input
                type="phone"
                class="form-control"
                id="CustomerPhone"
                placeholder="+38 (0XX) XXX XX XX"
                required
              />
            </label>
          </td>
        </tr>
        <tr>
          <td class="text-end">
            <button type="reset" onclick="resetRest()">
              Відновити значення полів
            </button>
            <button>Відіслати дані</button>
          </td>
        </tr>
      </table>
    </form>

    <div id="ordersContainer" style="margin-top: 20px"></div>

    <script>
      const books = [
        {
          name: "Благословення небесного урядника",
          author: "Мосян Тонсьов",
          price: 320,
        },
        {
          name: "Засновник демонічного шляху",
          author: "Мосян Тонсьов",
          price: 360,
        },
        { name: "Джейн Ейр", author: "Шарлотта Бронте", price: 280 },
        { name: "No Longer Human", author: "Осаму Дадзай", price: 713 },
        { name: "Інститут", author: "Стівен Кінг", price: 490 },
        { name: "Оніксова буря", author: "Ребекка Яррос", price: 850 },
        {
          name: "Вбивство на вулиці Морг",
          author: "Едгар Аллан По",
          price: 216,
        },
        {
          name: "Великий Гетсбі",
          author: "Френсіс Скотт Фіцджеральд",
          price: 330,
        },
        { name: "1984", author: "Джордж Орвелл", price: 144 },
        { name: "Перетворення", author: "Франц Кафка", price: 332 },
      ];

      const promocodes = [
        { name: "NEWCUSTOMER", discount: 20, used: false },
        { name: "BLACKFRIDAY", discount: 17, used: false },
        { name: "BIRTHDAYDISCOUNT", discount: 10, used: false },
        { name: "LOYALTYDISCOUNT", discount: 8, used: false },
      ];

      const qnt = document.getElementById("Quantity");
      const bookChoice = document.getElementById("Book");

      const orderList = document.getElementById("OrderList");
      let order = [];

      function addBook() {
        const selectedBookName = bookChoice.value;
        const quantity = Number(document.getElementById("Quantity").value);
        const book = books.find((b) => b.name === selectedBookName);

        if (!book || quantity < 1) return;

        const existing = order.find((item) => item.name === book.name);
        if (existing) {
          existing.quantity += quantity;
        } else {
          order.push({ name: book.name, price: book.price, quantity });
        }

        renderOrderList();
        updateCost();
      }

      function renderOrderList() {
        orderList.innerHTML = "";
        order.forEach((item, index) => {
          const li = document.createElement("li");
          li.textContent = `${item.name} — ${item.quantity} × ${
            item.price
          } грн = ${item.quantity * item.price} грн`;

          const delBtn = document.createElement("button");
          delBtn.textContent = "\u00d7";
          delBtn.style.padding = "0px 5px";
          delBtn.className = "btn btn-outline-danger ms-3";
          delBtn.onclick = () => {
            order.splice(index, 1);
            renderOrderList();
            updateCost();
          };

          li.appendChild(delBtn);
          orderList.appendChild(li);
        });
      }

      function AmountChange() {
        const selectedBook = books.find(
          (book) => book.name === bookChoice.value
        );
        const selectedAmount = Number(qnt.value);
        let total = 0;
        total = selectedBook.price * selectedAmount;
        let beforeDiscount = total;
        promocodes.forEach((element) => {
          if (element.used) {
            total -= Math.round(total * element.discount * 0.01);
          }
        });

        if (total != 0) {
          document.getElementById("Cost").value = total + "грн";
        }
      }

      function updateCost() {
        let total = order.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );

        promocodes.forEach((code) => {
          if (code.used) {
            total -= Math.round(total * code.discount * 0.01);
          }
        });

        document.getElementById("CostWithoutShipping").value = total + " грн";
      }

      function UsePromocode() {
        let correctPromocode = false;
        promocodes.forEach((element) => {
          if (document.getElementById("Promocode").value == element.name) {
            if (element.used) {
              alert("Промокод вже було застосовано.");
              correctPromocode = true;
            } else {
              correctPromocode = true;
              element.used = true;
              alert("Промокод успішно застосовано.");
            }
          }
        });

        if (!correctPromocode) {
          alert("Такого промокоду не знайдено.");
        }

        document.getElementById("Promocode").value = "";

        AmountChange();
        updateCost();
      }

      function CalculateCost() {
        const TotalCost = document.getElementById("TotalCost");
        let total = parseFloat(
          document
            .getElementById("CostWithoutShipping")
            .value.replace(/\s*грн\s*/i, "")
        );

        if (document.getElementById("Post").checked) {
          total *= document.getElementById("GiftWrap").checked ? 1.15 : 1.05;
        } else if (document.getElementById("Delivery").checked) {
          total *= document.getElementById("GiftWrap").checked ? 1.25 : 1.15;
        }

        TotalCost.value = Math.round(total) + " грн";
      }

      function resetRest() {
        promocodes.forEach((element) => {
          element.used = false;
        });
        order = [];
        renderOrderList();
        document.getElementById("DeliveryAdress").style.display = "none";
        const phoneNum = document.getElementById("CustomerPhone");
        phoneNum.classList.remove("error");
        phoneNum.placeholder = "+38 (0XX) XXX XX XX";
      }

      function validatePhone() {
        const phoneInput = document.getElementById("CustomerPhone");
        const error = document.getElementById("phoneError");

        const pattern = /^\+38 \(0\d{2}\) \d{3} \d{2} \d{2}$/;

        if (!pattern.test(phoneInput.value.trim())) {
          error.style.display = "inline";
          phoneInput.style.borderColor = "red";
        } else {
          error.style.display = "none";
          phoneInput.style.borderColor = "";
        }
      }

      function validateForm() {
        const phoneInput = document.getElementById("CustomerPhone");
        const pattern = /^\+38 \(0\d{2}\) \d{3} \d{2} \d{2}$/;

        if (!pattern.test(phoneInput.value.trim())) {
          phoneInput.classList.add("error");
          phoneInput.value = "";
          phoneInput.placeholder = "Неправильний формат вводу";
          return false;
        } else {
          phoneInput.classList.remove("error");
          phoneInput.placeholder = "+38 (0XX) XXX XX XX";
          return true;
        }
      }
      document
        .getElementById("CustomerPhone")
        .addEventListener("focus", function () {
          this.classList.remove("error");
          this.placeholder = "+38 (0XX) XXX XX XX";
        });

      document.querySelectorAll('input[name="delivery"]').forEach((radio) => {
        radio.addEventListener("change", () => {
          document.getElementById("DeliveryAdress").style.display =
            document.getElementById("Delivery").checked ? "block" : "none";
        });
      });

      qnt.addEventListener("input", AmountChange);
      bookChoice.addEventListener("change", function () {
        document.getElementById("Quantity").value = "";
        document.getElementById("Cost").value = "";
      });
      bookChoice.addEventListener("change", AmountChange);

      function formatDate(date) {
        const dd = String(date.getDate()).padStart(2, "0");
        const mm = String(date.getMonth() + 1).padStart(2, "0");
        const yyyy = date.getFullYear();

        const hh = String(date.getHours()).padStart(2, "0");
        const min = String(date.getMinutes()).padStart(2, "0");
        const ss = String(date.getSeconds()).padStart(2, "0");

        return `${dd}.${mm}.${yyyy} ${hh}:${min}:${ss}`;
      }

      const form = document.querySelector("form");
      const ordersContainer = document.getElementById("ordersContainer");

      let orderCounter = 1;

      form.addEventListener("submit", function (event) {
        event.preventDefault();

        if (!validateForm()) {
          return;
        }

        if (order.length === 0) {
          alert("Ви не вибрали жодної книги.");
          return;
        }

        const deliveryAddress = document.getElementById("DeliveryAdress").value;

        if (
          document.getElementById("Delivery").checked &&
          deliveryAddress === ""
        ) {
          alert("Ви не ввели адресу.");
          return;
        }

        CalculateCost();

        const deliveryMethod = document
          .querySelector('input[name="delivery"]:checked')
          .nextSibling.textContent.trim();

        const giftWrap = document.getElementById("GiftWrap").checked
          ? "Так"
          : "Ні";
        const customerName = document.getElementById("CustomerName").value;
        const customerSurname =
          document.getElementById("CustomerSurname").value;
        const customerPhone = document.getElementById("CustomerPhone").value;
        const totalCost = document.getElementById("TotalCost").value;
        const orderDate = new Date();

        let booksList = "<ul>";
        order.forEach((item) => {
          booksList += `<li>${item.name} — ${item.quantity} × ${
            item.price
          } грн = ${item.quantity * item.price} грн</li>`;
        });
        booksList += "</ul>";

        const used = promocodes.filter((p) => p.used);
        let usedPromocodes = "";

        if (used.length > 0) {
          usedPromocodes = "<ul>";
          used.forEach((p) => {
            usedPromocodes += `<li>${p.name} - ${p.discount}%</li>`;
          });
          usedPromocodes += "</ul>";
        }

        const card = document.createElement("div");
        card.style.border = "1px solid black";
        card.style.padding = "15px";
        card.style.marginBottom = "15px";
        card.style.backgroundColor = "#FAD5D5";
        card.style.minWidth = "550px";
        card.id = "Order" + orderCounter;

        card.innerHTML = `
    <h4 class="text-center">Замовлення номер ${orderCounter++}</h4>
    <hr />
    <p><strong>Книги:</strong> ${booksList}</p>

${
  usedPromocodes
    ? `<p><strong>Використані промокоди:</strong> ${usedPromocodes}</p>`
    : ""
}
    <p><strong>Спосіб доставки:</strong> ${deliveryMethod}</p>
    ${
      deliveryMethod === "Доставка до дому (+15%)"
        ? `<p><strong>Адреса доставки:</strong> ${deliveryAddress}</p>`
        : ""
    }
    <p><strong>Святкове упакування:</strong> ${giftWrap}</p>
    <p><strong>ПІБ:</strong> ${customerName} ${customerSurname}</p>
    <p><strong>Телефон:</strong> ${customerPhone}</p>
    <p><strong>Загальна вартість:</strong> ${totalCost}</p>
    <p class="text-end" style="font-size: 15px;"><i>Замовлення було оформлено: ${formatDate(
      orderDate
    )}</i></p>
  `;

        ordersContainer.appendChild(card);

        form.reset();
        resetRest();
      });
    </script>
  </body>
</html>
